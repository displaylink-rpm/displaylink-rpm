name: Build Check

on:
  push:
  pull_request:
    branches: [ master ]

jobs:
  makeTest:
    runs-on: ubuntu-latest
    container: 
      image: rockylinux/rockylinux:8
    steps:
      - uses: actions/checkout@v2

      - name: Test Makefile Targets
        run: ci/testbuilding.sh

  buildTest:
    runs-on: ubuntu-latest
    container: 
      image: ${{ matrix.dockernamespace }}:${{ matrix.version }}
    strategy:
      matrix:
        include:
            - os: fedora
              version: 29
              dockernamespace: fedora
            - os: fedora
              version: 30
              dockernamespace: fedora
            - os: fedora
              version: 31
              dockernamespace: fedora
            - os: fedora
              version: 32
              dockernamespace: fedora
            - os: fedora
              version: 33
              dockernamespace: fedora
            - os: fedora
              version: 34
              dockernamespace: fedora
            - os: fedora
              version: 35
              dockernamespace: fedora
            - os: centos
              version: 7.9.2009
              dockernamespace: centos
            - os: centos
              version: 8.4.2105
              dockernamespace: centos
            - os: rocky
              version: 8
              dockernamespace: rockylinux/rockylinux

    steps:
      - uses: actions/checkout@v2

      - name: Run CI
        run: ci/${{ matrix.os }}.sh
